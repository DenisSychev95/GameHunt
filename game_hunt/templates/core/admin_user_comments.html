{% extends "base.html" %}
{% load static %}

{% block title %}Комментарии пользователя{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/admin_panel.css' %}">
{% endblock %}

{% block content %}
<section class="admin-comments">

  <div class="admin-comments__topbar">
    <a class="gd-back small" href="{% url 'admin_dashboard' %}?section=users">К пользователям</a>
  </div>

  <h1 class="admin-comments__title">
    Комментарии пользователя {{ target_user.profile.nickname|default:target_user.username }}
  </h1>

  <form class="admin-comments__filters js-comments-filters" method="get" action="">
    <div class="admin-comments__filter-row" role="group" aria-label="Сортировка">
      {% for key, label in kinds %}
        <label class="admin-radio">
          <input type="radio" name="kind" value="{{ key }}" {% if key == kind %}checked{% endif %}>
          <span>{{ label }}</span>
        </label>
      {% endfor %}
    </div>
  </form>

  <div class="admin-scroll">
    {% if comments %}
      <table class="admin-table">
        <thead>
        <tr>
          <th class="admin-user-comments-table__col admin-user-comments-table__col--title">Название</th>
          <th class="admin-user-comments-table__col admin-user-comments-table__col--date">Дата</th>
          <th class="admin-user-comments-table__col admin-user-comments-table__col--text">Текст</th>
        </tr>
        </thead>

        <tbody>
        {% for c in comments %}
          <tr>
            <td class="admin-user-comments-table__col admin-user-comments-table__col--title">
              {% if kind == "games" %}
                <a class="admin-link" href="{% url 'game_detail' c.game.slug %}" target="_blank">{{ c.game.title }}</a>

              {% elif kind == "reviews" %}
                <a class="admin-link" href="{% url 'review_detail' c.review.pk %}" target="_blank">
                  {{ c.review.title }} ({{ c.review.game.title }})
                </a>

              {% elif kind == "walkthroughs" %}
                <a class="admin-link" href="{% url 'walkthrough_detail' c.walkthrough.slug %}" target="_blank">
                  {{ c.walkthrough.title }} ({{ c.walkthrough.game.title }})
                </a>

              {% elif kind == "cheats" %}
                <a class="admin-link" href="{% url 'cheat_detail' c.cheat.slug %}" target="_blank">
                  {{ c.cheat.title }} ({{ c.cheat.game.title }})
                </a>
              {% endif %}
            </td>

            <td class="admin-user-comments-table__col admin-user-comments-table__col--date">{{ c.updated_at|date:"d.m.Y H:i" }}</td>

            <td class="admin-user-comments-table__col admin-user-comments-table__col--text admin-comment-cell">
              <button type="button"
                      class="admin-link admin-comment-toggle js-comment-toggle"
                      aria-expanded="false">
                Показать
              </button>

              <div class="admin-comment-body js-comment-body" hidden>
                <div class="admin-comment-text">{{ c.text }}</div>
                {% if c.is_edited %}
                  <div class="admin-comment-meta">(отредактирован)</div>
                {% endif %}
              </div>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="admin-empty">Комментариев нет.</div>
    {% endif %}
  </div>

</section>
{% endblock %}

{% block page_js %}
  <script src="{% static 'js/admin_panel.js' %}"></script>
{% endblock %}