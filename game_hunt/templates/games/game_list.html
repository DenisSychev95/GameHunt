{% extends "base.html" %}
{% load static %}
{% block title %}GameHunt ‚Äî –ò–≥—Ä—ã{% endblock %}

{% block content %}
<section class="container">

  <h2 class="page-title center">–ö–∞—Ç–∞–ª–æ–≥ –∏–≥—Ä</h2>

  <!-- –ü–æ–∏—Å–∫ -->
  <form method="get" class="search-form">
    <input class="input"
           type="text"
           name="search"
           placeholder="–ü–æ–∏—Å–∫ –∏–≥—Ä"
           value="{{ current_query|default:'' }}">

    <select class="select" name="genre">
      <option value="">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
      {% for genre in genres %}
        <option value="{{ genre.id }}" {% if genre.id == current_genre %}selected{% endif %}>
          {{ genre.name }}
        </option>
      {% endfor %}
    </select>

    <select class="select" name="platform">
      <option value="">–í—Å–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</option>
      {% for platform in platforms %}
        <option value="{{ platform.id }}" {% if platform.id == current_platform %}selected{% endif %}>
          {{ platform.name }}
        </option>
      {% endfor %}
    </select>

    <select class="select" name="sort">
      <option value="new" {% if current_sort == "new" %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
      <option value="popular" {% if current_sort == "popular" %}selected{% endif %}>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</option>
      <option value="top" {% if current_sort == "top" %}selected{% endif %}>–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É</option>
    </select>

    <!-- –†–µ–π—Ç–∏–Ω–≥ -->
    <select class="select" name="min_rating">
      <option value="">–†–µ–π—Ç–∏–Ω–≥: –ª—é–±–æ–π</option>
      {% for r in rating_choices %}
        <option value="{{ r }}" {% if min_rating|stringformat:"s" == r|stringformat:"s" %}selected{% endif %}>
          –æ—Ç {{ r }}/10
        </option>
      {% endfor %}
    </select>

    <button class="btn" type="submit">–ù–∞–π—Ç–∏</button>

    {% if current_query or current_genre or current_platform or current_sort != "new" or min_rating %}
      <a class="link-muted" href="{% url 'game_list' %}">–°–±—Ä–æ—Å</a>
    {% endif %}
  </form>

  {% if games %}
    <div class="game-grid">
      {% for game in games %}
<article class="game-card">

  <div class="game-head">
    <h3 class="game-title">
      <a href="{% url 'game_detail' slug=game.slug %}">{{ game.title }}</a>
    </h3>

    <div class="game-views" title="–ü—Ä–æ—Å–º–æ—Ç—Ä—ã">üëÅ {{ game.views_count }}</div>
  </div>

  <a href="{% url 'game_detail' slug=game.slug %}" class="game-cover-link">
    {% if game.cover_image %}
      <img class="game-cover" src="{{ game.cover_image.url }}" alt="{{ game.title }}">
    {% else %}
      <div class="game-cover-placeholder">–ù–µ—Ç –æ–±–ª–æ–∂–∫–∏</div>
    {% endif %}
  </a>

  <div class="game-meta">
    –î–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞:
    {% if game.release_date %}
      {{ game.release_date|date:"d.m.Y" }}
    {% else %}
      ‚Äî
    {% endif %}
  </div>

  <div class="game-stats">
    <div>üëç {{ game.liked_percent|default:0 }}%</div>
    <div>‚≠êÔ∏è {{ game.avg_rating|default:"0.0" }}/10</div>
  </div>

  <div class="tags">
    {% for g in game.genres.all|slice:":6" %}
      <span class="tag">{{ g.name }}</span>
    {% empty %}
      <span class="tag">–∂–∞–Ω—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã</span>
    {% endfor %}
  </div>

  <div class="game-footer">
    <a class="btn btn-secondary" href="{% url 'game_detail' slug=game.slug %}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
  </div>

</article>
      {% endfor %}
    </div>

{% include 'pagination.html' with queryset=games %}

  {% else %}
    <p class="center muted">–ò–≥—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
  {% endif %}

</section>
{% endblock %}