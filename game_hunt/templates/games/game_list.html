{% extends "base.html" %}
{% load static %}
{% block title %}GameHunt — Игры{% endblock %}

{% block content %}
<section class="container">

  <h1 class="page-title center">Каталог игр</h1>

  <!-- Поиск -->
  <form method="get" class="search-form">
    <input class="input"
           type="text"
           name="search"
           placeholder="Поиск игр"
           value="{{ current_query|default:'' }}">

    <select class="select" name="genre">
      <option value="">Все жанры</option>
      {% for genre in genres %}
        <option value="{{ genre.id }}" {% if genre.id == current_genre %}selected{% endif %}>
          {{ genre.name }}
        </option>
      {% endfor %}
    </select>

    <select class="select" name="platform">
      <option value="">Все платформы</option>
      {% for platform in platforms %}
        <option value="{{ platform.id }}" {% if platform.id == current_platform %}selected{% endif %}>
          {{ platform.name }}
        </option>
      {% endfor %}
    </select>

    <select class="select" name="sort">
      <option value="new" {% if current_sort == "new" %}selected{% endif %}>Сначала новые</option>
      <option value="popular" {% if current_sort == "popular" %}selected{% endif %}>Популярные</option>
      <option value="top" {% if current_sort == "top" %}selected{% endif %}>По рейтингу</option>
    </select>

    <!-- Рейтинг -->
    <select class="select" name="min_rating">
      <option value="">Рейтинг: любой</option>
      {% for r in rating_choices %}
        <option value="{{ r }}" {% if min_rating|stringformat:"s" == r|stringformat:"s" %}selected{% endif %}>
          от {{ r }}/10
        </option>
      {% endfor %}
    </select>

    <button class="btn" type="submit">Найти</button>

    {% if current_query or current_genre or current_platform or current_sort != "new" or min_rating %}
      <a class="link-muted" href="{% url 'game_list' %}">Сброс</a>
    {% endif %}
  </form>

  {% if games %}
    <div class="game-grid">
      {% for game in games %}
<article class="game-card">

  <div class="game-head">
    <h3 class="game-title">
      <a href="{% url 'game_detail' slug=game.slug %}">{{ game.title }}</a>
    </h3>

    <div class="game-views" title="Просмотры"><span class="ui-meta">
  <span class="ui-icon ui-icon-eye"></span>
  {{ game.views_count }}
</span></div>
  </div>

  <a href="{% url 'game_detail' slug=game.slug %}" class="game-cover-link">
    {% if game.cover_image %}
      <img class="game-cover" src="{{ game.cover_image.url }}" alt="{{ game.title }}">
    {% else %}
      <div class="game-cover-placeholder">Нет обложки</div>
    {% endif %}
  </a>

  <div class="game-meta">
    Дата релиза:
    {% if game.release_date %}
      {{ game.release_date|date:"d.m.Y" }}
    {% else %}
      —
    {% endif %}
  </div>

  <div class="game-stats">
    <div class="like-love" title="Понравилось пользователям">
  <svg class="icon-love" viewBox="0 0 24 24" aria-hidden="true">
    <path d="M12 21s-7.5-4.35-10.5-9C-0.7 8.1 1.6 4 5.5 4
             c2.2 0 4.1 1.2 5 3 0.9-1.8 2.8-3 5-3
             3.9 0 6.2 4.1 4 8-3 4.65-10.5 9-10.5 9z"/>
  </svg>
  <span class="like-value">{{ game.liked_percent }}%</span>
</div>
<div class="rating-badge" title="Средний рейтинг">
  <svg class="icon-star" viewBox="0 0 24 24" aria-hidden="true">
    <path d="M12 17.3L18.2 21l-1.6-7L22 9.2l-7.2-.6L12 2
             9.2 8.6 2 9.2 7.4 14 5.8 21z"/>
  </svg>
  <span class="rating-text">{{ game.avg_rating }}/10</span>
</div>
  </div>

<div class="game-genres">
  {% for genre in game.genres.all %}
    <a class="genre-link"
       href="{% url 'game_list' %}?genre={{ genre.id }}"
       title="Показать игры жанра: {{ genre.name }}">
      {{ genre.name }}
    </a>
  {% empty %}
    <span class="genre-muted">Жанры не указаны</span>
  {% endfor %}
</div>

  <div class="game-footer">
    <a class="btn btn-secondary" href="{% url 'game_detail' slug=game.slug %}">Подробнее</a>
  </div>

</article>
      {% endfor %}
    </div>

{% include 'pagination.html' with queryset=games %}

  {% else %}
    <p class="center muted">Игры не найдены.</p>
  {% endif %}

</section>
{% endblock %}