{% extends "base.html" %}
{% load static %}
{% block title %}{{ game.title }} ‚Äî GameHunt{% endblock %}

{% block content %}
<section style="max-width: 900px; margin: 0 auto;">
    <h2 style="color: #f97316; margin-bottom: 8px;">{{ game.title }}</h2>

    {% if game.cover_image %}
        <img src="{{ game.cover_image.url }}" alt="{{ game.title }}"
             style="max-width: 300px; border-radius: 4px; margin-bottom: 12px;">
    {% endif %}

    <p style="font-size: 14px; color: #9ca3af;">
        –ñ–∞–Ω—Ä—ã:
        {% for genre in game.genres.all %}
            {{ genre.name }}{% if not forloop.last %}, {% endif %}
        {% empty %}
            –Ω–µ —É–∫–∞–∑–∞–Ω–æ
        {% endfor %}
        <br>
        –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã:
        {% for platform in game.platforms.all %}
            {{ platform.name }}{% if not forloop.last %}, {% endif %}
        {% empty %}
            –Ω–µ —É–∫–∞–∑–∞–Ω–æ
        {% endfor %}
        <br>
        –ü—Ä–æ—Å–º–æ—Ç—Ä—ã: {{ game.views_count }} |
        –õ–∞–π–∫–∏: {{ game.likes_count }} |
        –î–∏–∑–ª–∞–π–∫–∏: {{ game.dislikes_count }}
        {% if game.is_adult_only %}
            <br><strong style="color: #f87171;">–ö–æ–Ω—Ç–µ–Ω—Ç 18+</strong>
        {% endif %}
    </p>

    <p style="margin-top: 12px;">{{ game.description }}</p>

    {% if user.is_authenticated %}
        <div style="margin-top: 16px;">
            <form method="post" action="{% url 'game_vote' slug=game.slug value='like' %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit"
                        style="padding: 4px 10px; border-radius: 4px; border: none;
                               background-color: {% if user_vote and user_vote.value == 1 %}#16a34a{% else %}#4b5563{% endif %};
                               color: #fff;">
                    üëç –õ–∞–π–∫
                </button>
            </form>

            <form method="post" action="{% url 'game_vote' slug=game.slug value='dislike' %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit"
                        style="padding: 4px 10px; border-radius: 4px; border: none;
                               background-color: {% if user_vote and user_vote.value == -1 %}#dc2626{% else %}#4b5563{% endif %};
                               color: #fff; margin-left: 8px;">
                    üëé –î–∏–∑–ª–∞–π–∫
                </button>
            </form>
        </div>
    {% else %}
        <p style="margin-top: 12px; font-size: 14px;">
            –ß—Ç–æ–±—ã –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –∏ –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å,
            <a href="{% url 'account_login' %}" style="color: #f97316;">–∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å</a>.
        </p>
    {% endif %}

    <hr style="margin: 20px 0; border-color: #374151;">

    <h3 style="margin-bottom: 8px;">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
{% if comments %}
    {% for comment in comments %}
        <div style="margin-bottom: 12px; border-bottom: 1px solid #374151; padding-bottom: 8px;">

            <!-- –í–ï–†–•–ù–Ø–Ø –°–¢–†–û–ö–ê: –ê–í–ê–¢–ê–† + –ù–ò–ö –°–õ–ï–í–ê, –ö–û–ù–¢–†–û–õ–´ –°–ü–†–ê–í–ê -->
            <div style="display: flex; align-items: center; justify-content: space-between;">

                <!-- –õ–ï–í–ê–Ø –ß–ê–°–¢–¨ -->
    <div style="display: flex; flex-direction: column;">
                <!-- –î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ -->
        <span style="font-size: 12px; color: #9ca3af; margin-left: 36px;">
            {{ comment.created_at|date:"d.m.Y H:i" }}
        </span>
        <div style="display: flex; align-items: center; gap: 8px;">
            {% if comment.user.profile.profile_image %}
                <img src="{{ comment.user.profile.profile_image.url }}"
                     alt="{{ comment.user.profile.nickname }}"
                     style="width: 28px; height: 28px; border-radius: 50%; object-fit: cover;">
            {% else %}
                <img src="{% static 'images/default_avatar.png' %}"
                     alt="avatar"
                     style="width: 28px; height: 28px; border-radius: 50%; object-fit: cover;">
            {% endif %}

            <a href="{% url 'profile-view' comment.user.id %}"
               style="color: #f97316; font-size: 14px; text-decoration: none;">
                {{ comment.user.profile.nickname|default:comment.user.username }}
            </a>
        </div>




                </div>

                <!-- –ü–†–ê–í–ê–Ø –ß–ê–°–¢–¨ ‚Äî –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø -->
                {% if user.is_superuser or request.user == comment.user %}
                    <div style="display: flex; align-items: center; gap: 6px; justify-content: space-between;
                               width: 68px;">

                        {% if user == comment.user %}
                            <!-- –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                            <a href="{% url 'game_comment_edit' comment.id %}"
                               title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
                               style="
                                   display: inline-flex;
                                   align-items: center;
                                   justify-content: center;
                                   width: 24px;
                                   height: 24px;
                                   border-radius: 50%;
                                   background-color: #4b5563;
                                   color: white;
                                   font-size: 12px;
                                   text-decoration: none;
                                   cursor: pointer;">
                                ‚úèÔ∏è
                            </a>
                        {% endif %}

                        <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è -->
                        <form method="post"
                              action="{% url 'game_comment_delete' comment.id %}"
                              style="margin: 0; padding: 0;">
                            {% csrf_token %}
                            <button type="submit"
                                    onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?');"
                                    title="–£–¥–∞–ª–∏—Ç—å"
                                    style="
                                        width: 24px;
                                        height: 24px;
                                        display: inline-flex;
                                        align-items: center;
                                        justify-content: center;
                                        border-radius: 50%;
                                        border: none;
                                        background-color: #dc2626;
                                        color: white;
                                        font-size: 12px;
                                        cursor: pointer;">
                                ‚úñÔ∏è
                            </button>
                        </form>

                    </div>
                {% endif %}
            </div>

            <!-- –¢–ï–ö–°–¢ –ö–û–ú–ú–ï–ù–¢–ê–†–ò–Ø -->
            <p style="font-size: 14px; color: #e5e7eb; margin-left: 36px;">
                {{ comment.text }}
            </p>

        </div>
    {% endfor %}
{% else %}
    <p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.</p>
{% endif %}

    {% if user.is_authenticated %}
        <h4 style="margin-top: 16px;">–û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h4>
        <form method="post">
            {% csrf_token %}
            {{ comment_form.non_field_errors }}
            <div style="margin-bottom: 8px;">
                {{ comment_form.text }}
                {% if comment_form.text.errors %}
                    <div style="color: #f87171; font-size: 13px;">
                        {{ comment_form.text.errors|striptags }}
                    </div>
                {% endif %}
            </div>
            <button type="submit"
                    style="padding: 6px 12px; border: none; border-radius: 4px;
                            background-color: #f97316; color: #fff;">
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å
            </button>
        </form>
    {% endif %}
</section>
{% endblock %}