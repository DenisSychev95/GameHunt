{% extends "base.html" %}

{% block title %}{{ game.title }} ‚Äî GameHunt{% endblock %}

{% block content %}
<section style="max-width: 900px; margin: 0 auto;">
    <h2 style="color: #f97316; margin-bottom: 8px;">{{ game.title }}</h2>

    {% if game.cover_image %}
        <img src="{{ game.cover_image.url }}" alt="{{ game.title }}"
             style="max-width: 300px; border-radius: 4px; margin-bottom: 12px;">
    {% endif %}

    <p style="font-size: 14px; color: #9ca3af;">
        –ñ–∞–Ω—Ä—ã:
        {% for genre in game.genres.all %}
            {{ genre.name }}{% if not forloop.last %}, {% endif %}
        {% empty %}
            –Ω–µ —É–∫–∞–∑–∞–Ω–æ
        {% endfor %}
        <br>
        –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã:
        {% for platform in game.platforms.all %}
            {{ platform.name }}{% if not forloop.last %}, {% endif %}
        {% empty %}
            –Ω–µ —É–∫–∞–∑–∞–Ω–æ
        {% endfor %}
        <br>
        –ü—Ä–æ—Å–º–æ—Ç—Ä—ã: {{ game.views_count }} |
        –õ–∞–π–∫–∏: {{ game.likes_count }} |
        –î–∏–∑–ª–∞–π–∫–∏: {{ game.dislikes_count }}
        {% if game.is_adult_only %}
            <br><strong style="color: #f87171;">–ö–æ–Ω—Ç–µ–Ω—Ç 18+</strong>
        {% endif %}
    </p>

    <p style="margin-top: 12px;">{{ game.description }}</p>

    {% if user.is_authenticated %}
        <div style="margin-top: 16px;">
            <form method="post" action="{% url 'game_vote' slug=game.slug value='like' %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit"
                        style="padding: 4px 10px; border-radius: 4px; border: none;
                               background-color: {% if user_vote and user_vote.value == 1 %}#16a34a{% else %}#4b5563{% endif %};
                               color: #fff;">
                    üëç –õ–∞–π–∫
                </button>
            </form>

            <form method="post" action="{% url 'game_vote' slug=game.slug value='dislike' %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit"
                        style="padding: 4px 10px; border-radius: 4px; border: none;
                               background-color: {% if user_vote and user_vote.value == -1 %}#dc2626{% else %}#4b5563{% endif %};
                               color: #fff; margin-left: 8px;">
                    üëé –î–∏–∑–ª–∞–π–∫
                </button>
            </form>
        </div>
    {% else %}
        <p style="margin-top: 12px; font-size: 14px;">
            –ß—Ç–æ–±—ã –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –∏ –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, <a href="{% url 'account_login' %}" style="color: #f97316;">–≤–æ–π–¥–∏—Ç–µ</a>.
        </p>
    {% endif %}

    <hr style="margin: 20px 0; border-color: #374151;">

    <h3 style="margin-bottom: 8px;">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>

    {% if comments %}
        <ul style="list-style: none; padding-left: 0;">
            {% for comment in comments %}
                <li style="margin-bottom: 12px; border-bottom: 1px solid #374151; padding-bottom: 8px;">
                    <strong>{{ comment.user.profile.nickname|default:comment.user.username }}</strong>
                    <span style="font-size: 12px; color: #9ca3af;">
                        {{ comment.created_at|date:"d.m.Y H:i" }}
                    </span>
                    <p style="margin-top: 4px;">{{ comment.text }}</p>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.</p>
    {% endif %}

    {% if user.is_authenticated %}
        <h4 style="margin-top: 16px;">–û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h4>
        <form method="post">
            {% csrf_token %}
            {{ comment_form.non_field_errors }}
            <div style="margin-bottom: 8px;">
                {{ comment_form.text }}
                {% if comment_form.text.errors %}
                    <div style="color: #f87171; font-size: 13px;">
                        {{ comment_form.text.errors|striptags }}
                    </div>
                {% endif %}
            </div>
            <button type="submit"
                    style="padding: 6px 12px; border: none; border-radius: 4px;
                            background-color: #f97316; color: #fff;">
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å
            </button>
        </form>
    {% endif %}
</section>
{% endblock %}