{% extends "base.html" %}
{% load static %}

{% block title %}GameHunt ‚Äî {{ game.title }}{% endblock %}

{% block content %}
<section class="gd">

  <!-- –í–µ—Ä—Ö–Ω—è—è —Å—Ç—Ä–æ–∫–∞: –Ω–∞–∑–∞–¥ –∫–æ –≤—Å–µ–º –∏–≥—Ä–∞–º -->
  <div class="gd-topbar">
    <a class="gd-back" href="{% url 'game_list' %}">‚Üê –í—Å–µ –∏–≥—Ä—ã</a>
  </div>

  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
  <header class="gd-header">
    <h1 class="gd-title">{{ game.title }}</h1>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="gd-nav">
      <div class="gd-nav-left">
        –°–º–æ—Ç—Ä–µ—Ç—å
        <a class="btn gd-view_content" href="{% url 'review_list' %}?game={{ game.slug }}">–û–±–∑–æ—Ä—ã</a>
        <a class="btn gd-view_content" href="{% url 'walkthrough_list' %}?game={{ game.slug }}">–ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è</a>
        <a class="btn gd-view_content" href="{% url 'cheat_list' %}?game={{ game.slug }}">–ß–∏—Ç—ã</a>
      </div>

      <div class="gd-nav-right">
        {% if user.is_authenticated %}
        –î–æ–±–∞–≤–∏—Ç—å
          <a class="pager-link gd-add_content" href="{% url 'review_create' game.slug %}">–û–±–∑–æ—Ä</a>
          <a class="pager-link gd-add_content" href="{% url 'walkthrough_create' game.slug %}">–ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ</a>
          <a class="pager-link gd-add_content" href="{% url 'cheat_create' game.slug %}">–ß–∏—Ç</a>
        {% else %}
          <a class="gd-pill gd-pill-add" href="{% url 'account_login' %}">–í–æ–π—Ç–∏, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å</a>
        {% endif %}
      </div>
    </div>
  </header>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç: —Å–ª–µ–≤–∞ –æ–±–ª–æ–∂–∫–∞+–º–µ—Ç–∞, —Å–ø—Ä–∞–≤–∞ –æ–ø–∏—Å–∞–Ω–∏–µ -->
  <div class="gd-main">

    <aside class="gd-left">
      {% if game.cover_image %}
        <img class="gd-cover" src="{{ game.cover_image.url }}" alt="{{ game.title }}">
      {% endif %}

      <div class="gd-meta-card">
        <div class="gd-meta-row">
          <span class="gd-meta-label">–î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞:</span>
          <span class="gd-meta-value">
            {% if game.release_date %}{{ game.release_date|date:"d.m.Y" }}{% else %}‚Äî{% endif %}
          </span>
        </div>

        <div class="gd-meta-row">
          <span class="gd-meta-label">–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã:</span>
          <span class="gd-meta-value">
            {% for p in game.platforms.all %}
              {{ p.name }}{% if not forloop.last %}, {% endif %}
            {% empty %}‚Äî{% endfor %}
          </span>
        </div>

        <div class="gd-meta-row">
          <span class="gd-meta-label">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:</span>
          <span class="gd-meta-value">{{ game.developer|default:"‚Äî" }}</span>
        </div>

        <div class="gd-meta-row">
          <span class="gd-meta-label">–ò–∑–¥–∞—Ç–µ–ª—å:</span>
          <span class="gd-meta-value">{{ game.publisher|default:"‚Äî" }}</span>
        </div>
      </div>
    </aside>

    <div class="gd-right">
      <div class="gd-text">{{ game.description|linebreaks }}</div>
    </div>

  </div>

  {% if game.gallery.all %}
<section class="gd-gallery" data-gallery data-page-size="5">
  <h2 class="gd-section-title">–ì–∞–ª–µ—Ä–µ—è</h2>

  <div class="gd-carousel">
    <button class="gd-carousel-btn" type="button" data-prev aria-label="–ù–∞–∑–∞–¥">‚Äπ</button>

    <div class="gd-carousel-viewport">
      <div class="gd-carousel-track">
        {% for img in game.gallery.all %}
          <a href="{{ img.image.url }}"
   class="gd-thumb glightbox"
   data-gallery="game-{{ game.id }}"
   data-title="{{ img.caption|default:'' }}"
   data-index="{{ forloop.counter0 }}">
  <img src="{{ img.image.url }}">
</a>
        {% endfor %}
      </div>
    </div>

    <button class="gd-carousel-btn" type="button" data-next aria-label="–í–ø–µ—Ä—ë–¥">‚Ä∫</button>
  </div>

  <p class="gd-hint" data-counter></p>
</section>
{% endif %}

  {% if trailer_embed %}
<section class="gd-block">
  <h2 class="gd-section-title">–¢—Ä–µ–π–ª–µ—Ä</h2>

  <div class="gd-video">
    <iframe
      src="{{ trailer_embed }}"
      title="Trailer"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      allowfullscreen>
    </iframe>
  </div>
</section>
{% endif %}
  <!-- –û—Ü–µ–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <section class="gd-block">
    <h2 class="gd-section-title">–û—Ü–µ–Ω–∏—Ç—å</h2>

    <div class="gd-vote">
      {% if user.is_authenticated %}
        <form method="post" action="{% url 'game_vote' game.slug %}" class="gd-vote-row">
          {% csrf_token %}<button class="gd-vote-btn" name="value" value="1" type="submit">üëç <span>–õ–∞–π–∫</span></button>
          <button class="gd-vote-btn" name="value" value="-1" type="submit">üëé <span>–î–∏–∑–ª–∞–π–∫</span></button>
        </form>
        <p class="gd-hint">–ì–æ–ª–æ—Å –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å ‚Äî —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –≥–æ–ª–æ—Å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.</p>
      {% else %}
        <p class="gd-hint">–ß—Ç–æ–±—ã –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å, –Ω—É–∂–Ω–æ <a href="{% url 'account_login' %}">–≤–æ–π—Ç–∏</a>.</p>
      {% endif %}
    </div>
  </section>
<!-- –ø–æ—Ç–æ–º —Ñ–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    {% if user.is_authenticated %}
      <form class="gd-comment-form" method="post" action="{% url 'game_add_comment' game.slug %}">
        {% csrf_token %}
        {{ comment_form.non_field_errors }}

        <div class="gd-comment-field">
          {{ comment_form.text.errors }}
          {{ comment_form.text }}
        </div>

        <button class="gd-btn-primary" type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <p class="gd-hint">–ù–µ —á–∞—â–µ 1 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –≤ –º–∏–Ω—É—Ç—É.</p>
      </form>
    {% else %}
      <p class="gd-hint"><a href="{% url 'account_login' %}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –ø–∏—Å–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏.</p>
    {% endif %}
  <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: —Å–Ω–∞—á–∞–ª–∞ —Å–ø–∏—Å–æ–∫ -->
  <section class="gd-comments">
    <h2 class="gd-section-title">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h2>

    <div class="gd-comment-list">
      {% for comment in comments %}
        <article class="gd-comment">

          <div class="gd-comment-head">
            <div class="gd-comment-left">
              <span class="gd-comment-date">{{ comment.created_at|date:"d.m.Y H:i" }}</span>

              <div class="gd-comment-user">
                {% if comment.user.profile.profile_image %}
                  <img class="gd-comment-avatar"
                       src="{{ comment.user.profile.profile_image.url }}"
                       alt="{{ comment.user.profile.nickname }}">
                {% else %}
                  <img class="gd-comment-avatar"
                       src="{% static 'images/default_avatar.png' %}"
                       alt="avatar">
                {% endif %}

                <a class="gd-comment-author" href="{% url 'profile-view' comment.user.id %}">
                  {{ comment.user.profile.nickname|default:comment.user.username }}
                </a>
              </div>
            </div>

            {% if user.is_superuser or request.user == comment.user %}
              <div class="gd-comment-actions">

                {% if user == comment.user %}
                  <a class="gd-comment-action gd-comment-edit"
                     href="{% url 'game_comment_edit' comment.id %}"
                     title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                {% endif %}

                <form method="post" action="{% url 'game_comment_delete' comment.id %}" class="gd-comment-delete-form">
                  {% csrf_token %}
                  <button class="gd-comment-action gd-comment-delete"
                          type="submit"
                          onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?');"
                          title="–£–¥–∞–ª–∏—Ç—å">‚úñÔ∏è</button>
                </form>

              </div>
            {% endif %}
          </div>

          <div class="gd-comment-body">
            {{ comment.text|linebreaks }}
          </div>

        </article>
      {% empty %}
        <p class="gd-hint">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
      {% endfor %}
    </div>

  </section>

</section>


{% endblock %}

{% block page_js %}
  <script src="{% static 'js/game_detail.js' %}"></script>
{% endblock %}